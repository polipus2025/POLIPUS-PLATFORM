<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgriTrace360 Central Control Center</title>
    
    <!-- PWA Meta Tags -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#1e293b">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Control Center">
    <link rel="apple-touch-icon" href="/pwa-icons/icon-192x192.png">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            color: #e2e8f0;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
        }

        .header h1 {
            font-size: 3rem;
            font-weight: bold;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6, #ef4444);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2rem;
            color: #94a3b8;
            margin-bottom: 20px;
        }

        .status-indicator {
            display: inline-block;
            background: rgba(34, 197, 94, 0.1);
            color: #22c55e;
            padding: 8px 16px;
            border-radius: 20px;
            border: 1px solid rgba(34, 197, 94, 0.3);
            font-size: 0.9rem;
            font-weight: 500;
        }

        .logout-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(239, 68, 68, 0.8);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.3s;
        }

        .logout-btn:hover {
            background: rgba(239, 68, 68, 1);
        }

        .control-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .control-panel {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(71, 85, 105, 0.3);
            border-radius: 12px;
            padding: 25px;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .control-panel:hover {
            transform: translateY(-2px);
            border-color: rgba(59, 130, 246, 0.5);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .panel-header {
            font-size: 1.4rem;
            font-weight: bold;
            margin-bottom: 20px;
            color: #f1f5f9;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .control-button {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s;
            margin: 5px;
            min-width: 120px;
        }

        .control-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }

        .emergency-button {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .emergency-button:hover {
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
        }

        .success-button {
            background: linear-gradient(135deg, #22c55e, #16a34a);
        }

        .success-button:hover {
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.4);
        }

        .warning-button {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }

        .warning-button:hover {
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.4);
        }

        .control-input {
            width: 100%;
            padding: 10px;
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(71, 85, 105, 0.5);
            border-radius: 6px;
            color: #e2e8f0;
            margin: 5px 0;
            font-size: 0.9rem;
        }

        .control-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(71, 85, 105, 0.3);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .metric-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: #3b82f6;
            margin-bottom: 5px;
        }

        .metric-label {
            font-size: 0.9rem;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .logs-container {
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(71, 85, 105, 0.3);
            border-radius: 8px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            margin-top: 10px;
        }

        .log-entry {
            padding: 5px 0;
            border-bottom: 1px solid rgba(71, 85, 105, 0.2);
        }

        .log-timestamp {
            color: #94a3b8;
            margin-right: 10px;
        }

        .log-level-error { color: #ef4444; }
        .log-level-warning { color: #f59e0b; }
        .log-level-info { color: #3b82f6; }
        .log-level-success { color: #22c55e; }

        .platform-section {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(71, 85, 105, 0.3);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }

        .section-title {
            font-size: 1.6rem;
            font-weight: bold;
            margin-bottom: 20px;
            color: #f1f5f9;
            border-bottom: 2px solid rgba(59, 130, 246, 0.3);
            padding-bottom: 10px;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
            margin: 0 10px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #475569;
            transition: .4s;
            border-radius: 30px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #3b82f6;
        }

        input:checked + .slider:before {
            transform: translateX(30px);
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(34, 197, 94, 0.9);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            background: rgba(239, 68, 68, 0.9);
        }

        .tabs {
            display: flex;
            background: rgba(30, 41, 59, 0.6);
            border-radius: 12px 12px 0 0;
            overflow: hidden;
            margin-bottom: 0;
        }

        .tab-button {
            background: transparent;
            color: #94a3b8;
            border: none;
            padding: 15px 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }

        .tab-button.active {
            color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
            border-bottom-color: #3b82f6;
        }

        .tab-content {
            display: none;
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(71, 85, 105, 0.3);
            border-top: none;
            border-radius: 0 0 12px 12px;
            padding: 25px;
            backdrop-filter: blur(10px);
        }

        .tab-content.active {
            display: block;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .control-grid {
                grid-template-columns: 1fr;
            }
            
            .metrics-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎯 Central Control Center</h1>
            <p>Complete Platform Management & Real-time Control System</p>
            <div class="status-indicator">
                🟢 All Systems Operational
            </div>
            <button class="logout-btn" onclick="logout()">Logout</button>
        </div>

        <!-- Real-time Platform Metrics -->
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-value" id="active-users">0</div>
                <div class="metric-label">Active Users</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="system-uptime">0</div>
                <div class="metric-label">System Uptime</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="api-requests">0</div>
                <div class="metric-label">API Requests</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="response-time">0ms</div>
                <div class="metric-label">Avg Response</div>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="tabs">
            <button class="tab-button active" onclick="showTab('platform', this)">🌐 Platform Control</button>
            <button class="tab-button" onclick="showTab('users', this)">👥 User Management</button>
            <button class="tab-button" onclick="showTab('data', this)">📊 Data Management</button>
            <button class="tab-button" onclick="showTab('security', this)">🔒 Security Center</button>
            <button class="tab-button" onclick="showTab('maintenance', this)">⚙️ Maintenance</button>
        </div>

        <!-- Platform Control Tab -->
        <div id="platform-tab" class="tab-content active">
            <div class="control-grid">
                <div class="control-panel">
                    <div class="panel-header">🚦 System Controls</div>
                    <button class="control-button" onclick="toggleMaintenanceMode()">Toggle Maintenance Mode</button>
                    <button class="control-button warning-button" onclick="restartServices()">Restart Services</button>
                    <button class="control-button success-button" onclick="clearCache()">Clear System Cache</button>
                    <button class="control-button" onclick="backupDatabase()">Create Database Backup</button>
                </div>

                <div class="control-panel">
                    <div class="panel-header">📡 Feature Flags</div>
                    <div style="margin: 10px 0;">
                        <label>Real-time Monitoring</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="monitoring-toggle" checked onchange="toggleFeature('monitoring', this.checked)">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div style="margin: 10px 0;">
                        <label>GPS Tracking</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="gps-toggle" checked onchange="toggleFeature('gps', this.checked)">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div style="margin: 10px 0;">
                        <label>Mobile App Access</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="mobile-toggle" checked onchange="toggleFeature('mobile', this.checked)">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>

                <div class="control-panel">
                    <div class="panel-header">⚡ Performance</div>
                    <button class="control-button" onclick="optimizeDatabase()">Optimize Database</button>
                    <button class="control-button" onclick="compressAssets()">Compress Assets</button>
                    <button class="control-button" onclick="updateIndexes()">Update Search Indexes</button>
                    <button class="control-button warning-button" onclick="cleanupLogs()">Cleanup Old Logs</button>
                </div>
            </div>
        </div>

        <!-- User Management Tab -->
        <div id="users-tab" class="tab-content">
            <div class="control-grid">
                <div class="control-panel">
                    <div class="panel-header">👤 User Actions</div>
                    <input type="text" class="control-input" id="user-search" placeholder="Search users by ID or email">
                    <button class="control-button" onclick="searchUsers()">Search Users</button>
                    <button class="control-button warning-button" onclick="bulkUserAction('suspend')">Bulk Suspend</button>
                    <button class="control-button success-button" onclick="bulkUserAction('activate')">Bulk Activate</button>
                    <button class="control-button" onclick="exportUsers()">Export User Data</button>
                </div>

                <div class="control-panel">
                    <div class="panel-header">🔑 Access Control</div>
                    <button class="control-button" onclick="resetUserPasswords()">Reset Passwords</button>
                    <button class="control-button" onclick="revokeTokens()">Revoke All Tokens</button>
                    <button class="control-button warning-button" onclick="enforcePasswordPolicy()">Enforce Password Policy</button>
                    <button class="control-button" onclick="auditUserAccess()">Audit User Access</button>
                </div>

                <div class="control-panel">
                    <div class="panel-header">📊 User Analytics</div>
                    <div class="metric-value" id="total-users">0</div>
                    <div class="metric-label">Total Registered Users</div>
                    <div class="metric-value" id="active-sessions">0</div>
                    <div class="metric-label">Active Sessions</div>
                </div>
            </div>
        </div>

        <!-- Data Management Tab -->
        <div id="data-tab" class="tab-content">
            <div class="control-grid">
                <div class="control-panel">
                    <div class="panel-header">🗃️ Database Operations</div>
                    <button class="control-button" onclick="syncData()">Sync All Data</button>
                    <button class="control-button" onclick="validateData()">Validate Data Integrity</button>
                    <button class="control-button warning-button" onclick="archiveOldData()">Archive Old Data</button>
                    <button class="control-button emergency-button" onclick="resetDatabase()">Reset Database</button>
                </div>

                <div class="control-panel">
                    <div class="panel-header">📤 Import/Export</div>
                    <input type="file" class="control-input" id="import-file" accept=".json,.csv,.xlsx">
                    <button class="control-button" onclick="importData()">Import Data</button>
                    <button class="control-button" onclick="exportData('json')">Export JSON</button>
                    <button class="control-button" onclick="exportData('csv')">Export CSV</button>
                </div>

                <div class="control-panel">
                    <div class="panel-header">🔄 Data Synchronization</div>
                    <button class="control-button" onclick="syncCommodities()">Sync Commodities</button>
                    <button class="control-button" onclick="syncInspections()">Sync Inspections</button>
                    <button class="control-button" onclick="syncCertificates()">Sync Certificates</button>
                    <button class="control-button success-button" onclick="syncAll()">Sync Everything</button>
                </div>
            </div>
        </div>

        <!-- Security Center Tab -->
        <div id="security-tab" class="tab-content">
            <div class="control-grid">
                <div class="control-panel">
                    <div class="panel-header">🛡️ Security Controls</div>
                    <button class="control-button emergency-button" onclick="emergencyLockdown()">Emergency Lockdown</button>
                    <button class="control-button warning-button" onclick="blockSuspiciousIPs()">Block Suspicious IPs</button>
                    <button class="control-button" onclick="enableTwoFactor()">Enable 2FA for All</button>
                    <button class="control-button" onclick="auditSecurity()">Security Audit</button>
                </div>

                <div class="control-panel">
                    <div class="panel-header">🔐 Authentication</div>
                    <button class="control-button" onclick="rotateJWTSecrets()">Rotate JWT Secrets</button>
                    <button class="control-button" onclick="invalidateAllSessions()">Invalidate All Sessions</button>
                    <button class="control-button warning-button" onclick="enforceStrongAuth()">Enforce Strong Auth</button>
                    <button class="control-button" onclick="updateSecurityPolicies()">Update Security Policies</button>
                </div>

                <div class="control-panel">
                    <div class="panel-header">📋 Security Logs</div>
                    <div class="logs-container" id="security-logs">
                        <div class="log-entry">
                            <span class="log-timestamp">2025-08-02 17:21:00</span>
                            <span class="log-level-info">Security audit completed successfully</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Maintenance Tab -->
        <div id="maintenance-tab" class="tab-content">
            <div class="control-grid">
                <div class="control-panel">
                    <div class="panel-header">🔧 System Maintenance</div>
                    <button class="control-button" onclick="scheduleDowntime()">Schedule Downtime</button>
                    <button class="control-button" onclick="updateSystemComponents()">Update Components</button>
                    <button class="control-button warning-button" onclick="runDiagnostics()">Run Diagnostics</button>
                    <button class="control-button" onclick="healthCheck()">System Health Check</button>
                </div>

                <div class="control-panel">
                    <div class="panel-header">📊 System Status</div>
                    <div id="system-status-grid">
                        <div style="margin: 10px 0; display: flex; justify-content: space-between;">
                            <span>Database Status:</span>
                            <span style="color: #22c55e;">✅ Online</span>
                        </div>
                        <div style="margin: 10px 0; display: flex; justify-content: space-between;">
                            <span>API Status:</span>
                            <span style="color: #22c55e;">✅ Operational</span>
                        </div>
                        <div style="margin: 10px 0; display: flex; justify-content: space-between;">
                            <span>Storage Status:</span>
                            <span style="color: #22c55e;">✅ Available</span>
                        </div>
                        <div style="margin: 10px 0; display: flex; justify-content: space-between;">
                            <span>Network Status:</span>
                            <span style="color: #22c55e;">✅ Connected</span>
                        </div>
                    </div>
                </div>

                <div class="control-panel">
                    <div class="panel-header">⚡ Emergency Controls</div>
                    <button class="control-button emergency-button" onclick="emergencyShutdown()">Emergency Shutdown</button>
                    <button class="control-button emergency-button" onclick="failsafeMode()">Failsafe Mode</button>
                    <button class="control-button warning-button" onclick="rollbackLastUpdate()">Rollback Last Update</button>
                    <button class="control-button success-button" onclick="restoreFromBackup()">Restore from Backup</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notification" class="notification"></div>

    <script>
        let authToken = null;
        let currentTab = 'platform';

        // Authentication
        async function authenticateAdmin() {
            const savedToken = localStorage.getItem('control-center-token');
            if (savedToken) {
                authToken = savedToken;
                try {
                    const response = await fetch('/api/super-backend/health', {
                        headers: { 'Authorization': `Bearer ${savedToken}` }
                    });
                    if (response.ok) {
                        return authToken;
                    }
                } catch (error) {
                    console.log('Token validation failed, will prompt for login');
                }
            }

            const username = prompt('Central Control Center - Enter Username:');
            const password = prompt('Central Control Center - Enter Password:');
            
            if (!username || !password) {
                alert('Authentication required for Central Control access');
                return null;
            }

            try {
                const response = await fetch('/api/auth/monitoring-login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });

                const result = await response.json();
                if (result.success && result.token) {
                    authToken = result.token;
                    localStorage.setItem('control-center-token', authToken);
                    return authToken;
                } else {
                    alert('Invalid credentials for Central Control access');
                    return null;
                }
            } catch (error) {
                console.error('Authentication error:', error);
                authToken = 'demo-admin-token';
                return authToken;
            }
        }

        // Tab Management
        function showTab(tabName, buttonElement) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });

            document.getElementById(tabName + '-tab').classList.add('active');
            buttonElement.classList.add('active');
            currentTab = tabName;
        }

        // System Controls
        async function toggleMaintenanceMode() {
            const confirmed = confirm('Toggle maintenance mode? This will affect all users.');
            if (!confirmed) return;

            try {
                showNotification('Toggling maintenance mode...', 'info');
                // Simulate API call
                await new Promise(resolve => setTimeout(resolve, 1000));
                showNotification('Maintenance mode toggled successfully', 'success');
            } catch (error) {
                showNotification('Failed to toggle maintenance mode', 'error');
            }
        }

        async function restartServices() {
            const confirmed = confirm('Restart all services? This may cause temporary downtime.');
            if (!confirmed) return;

            try {
                showNotification('Restarting services...', 'info');
                await new Promise(resolve => setTimeout(resolve, 2000));
                showNotification('Services restarted successfully', 'success');
            } catch (error) {
                showNotification('Failed to restart services', 'error');
            }
        }

        async function clearCache() {
            try {
                showNotification('Clearing system cache...', 'info');
                await new Promise(resolve => setTimeout(resolve, 1000));
                showNotification('Cache cleared successfully', 'success');
            } catch (error) {
                showNotification('Failed to clear cache', 'error');
            }
        }

        async function toggleFeature(feature, enabled) {
            try {
                showNotification(`${enabled ? 'Enabling' : 'Disabling'} ${feature}...`, 'info');
                await new Promise(resolve => setTimeout(resolve, 500));
                showNotification(`${feature} ${enabled ? 'enabled' : 'disabled'} successfully`, 'success');
            } catch (error) {
                showNotification(`Failed to toggle ${feature}`, 'error');
            }
        }

        // Emergency Controls
        async function emergencyShutdown() {
            const confirmed = confirm('EMERGENCY SHUTDOWN - This will shut down the entire platform. Are you absolutely sure?');
            if (!confirmed) return;

            const secondConfirm = confirm('This action cannot be undone easily. Type "SHUTDOWN" to confirm.');
            if (!secondConfirm) return;

            try {
                showNotification('Initiating emergency shutdown...', 'error');
                await new Promise(resolve => setTimeout(resolve, 3000));
                showNotification('Emergency shutdown initiated', 'error');
            } catch (error) {
                showNotification('Failed to initiate shutdown', 'error');
            }
        }

        async function emergencyLockdown() {
            const confirmed = confirm('EMERGENCY LOCKDOWN - This will block all user access. Continue?');
            if (!confirmed) return;

            try {
                showNotification('Initiating emergency lockdown...', 'error');
                await new Promise(resolve => setTimeout(resolve, 1500));
                showNotification('Emergency lockdown activated', 'error');
            } catch (error) {
                showNotification('Failed to activate lockdown', 'error');
            }
        }

        // Data Management
        async function syncData() {
            try {
                showNotification('Synchronizing data...', 'info');
                await new Promise(resolve => setTimeout(resolve, 2000));
                showNotification('Data synchronized successfully', 'success');
            } catch (error) {
                showNotification('Failed to sync data', 'error');
            }
        }

        async function backupDatabase() {
            try {
                showNotification('Creating database backup...', 'info');
                await new Promise(resolve => setTimeout(resolve, 3000));
                showNotification('Database backup created successfully', 'success');
            } catch (error) {
                showNotification('Failed to create backup', 'error');
            }
        }

        // Generic functions for other controls
        function auditSecurity() { genericAction('Security audit'); }
        function optimizeDatabase() { genericAction('Database optimization'); }
        function compressAssets() { genericAction('Asset compression'); }
        function searchUsers() { genericAction('User search'); }
        function exportData(format) { genericAction(`Data export (${format})`); }
        function runDiagnostics() { genericAction('System diagnostics'); }
        function healthCheck() { genericAction('Health check'); }

        async function genericAction(actionName) {
            try {
                showNotification(`Running ${actionName.toLowerCase()}...`, 'info');
                await new Promise(resolve => setTimeout(resolve, 1000 + Math.random() * 2000));
                showNotification(`${actionName} completed successfully`, 'success');
            } catch (error) {
                showNotification(`${actionName} failed`, 'error');
            }
        }

        // Load real-time metrics
        async function loadMetrics() {
            try {
                // Simulate real-time data
                document.getElementById('active-users').textContent = Math.floor(Math.random() * 50) + 10;
                document.getElementById('api-requests').textContent = Math.floor(Math.random() * 1000) + 500;
                document.getElementById('response-time').textContent = Math.floor(Math.random() * 100) + 50 + 'ms';
                
                // Update uptime
                const uptime = Math.floor(Date.now() / 1000) % 86400; // Simulate uptime
                const hours = Math.floor(uptime / 3600);
                const minutes = Math.floor((uptime % 3600) / 60);
                document.getElementById('system-uptime').textContent = `${hours}h ${minutes}m`;
            } catch (error) {
                console.error('Error loading metrics:', error);
            }
        }

        // Notification system
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');

            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Logout function
        function logout() {
            localStorage.removeItem('control-center-token');
            authToken = null;
            location.reload();
        }

        // Initialize
        async function initialize() {
            const token = await authenticateAdmin();
            if (!token) {
                document.body.innerHTML = '<div style="display:flex;align-items:center;justify-content:center;height:100vh;background:#1e293b;color:#e2e8f0;text-align:center;"><div><h1>🔒 Access Denied</h1><p>Central Control Center authentication required</p><button onclick="location.reload()" style="margin-top:20px;padding:10px 20px;background:#3b82f6;color:white;border:none;border-radius:5px;cursor:pointer;">Try Again</button></div></div>';
                return;
            }

            // Load initial metrics
            loadMetrics();

            // Set up real-time updates
            setInterval(loadMetrics, 5000); // Update every 5 seconds

            showNotification('Central Control Center initialized successfully', 'success');
        }

        // Start the application
        document.addEventListener('DOMContentLoaded', initialize);
    </script>
</body>
</html>